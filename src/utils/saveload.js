import{player,setupPlayer}from"../player.js";import{notify}from"./notify.js";import{updateVer}from"./version.js";import LZString from"./lz-string.js";const SAVE_KEY="the_longest_incremental_2";function fixData(e,o){for(const t in o){const r=o[t];"object"==typeof r&&null!==r?void 0!==r.length&&void 0===e.length||void 0===r.length&&void 0!==e.length?e[t]=r:fixData(e[t],r):e[t]=r}}function compress(){return LZString.compressToBase64(JSON.stringify(player))}function decompress(e){return JSON.parse(LZString.decompressFromBase64(e))}let canSave=!0;export function save(e){canSave?(e&&notify("Game saved."),localStorage.setItem(SAVE_KEY,compress())):notify("For some reason, the game has disabled saving. Please check with the developers!")}export function load(e){const o=e||localStorage.getItem(SAVE_KEY);if(null!==o&&""!==o)try{const e="{"===o[0]?JSON.parse(o):decompress(o);fixData(player,e),notify("Game loaded."),updateVer()}catch(e){console.error(e),notify("Your save is invalid. Sorry!")}}export function importSave(){load(prompt("Input your save here!")),save()}export async function exportSave(){try{await navigator.clipboard.writeText(compress()),notify("Save exported!")}catch(e){notify("For some reason the game failed to export your save."),console.error(e)}}export function hardReset(e=!1){!e&&confirm("Are you sure? This is not the soft reset you are looking for. THIS WILL RESET THE ENTIRE GAME WITH NO REWARD.")&&(Object.assign(player,setupPlayer()),e||notify("Welcome back to the beginning."),save())}export const saveInterval=setInterval(save,3e4);window.onbeforeunload=save;
